<!DOCTYPE html>
<html>
  <head>
    <title>Step 7 :: Simple Paint</title>
    <!-- note : in HTML5 no need to specify type=...-->
    <link rel="stylesheet" href="css/paint.css" />
   
  </head>
  <body>
    <div id="container">
        <div id="content">
            <div id="divCanvas">
                <canvas id="canvasMain">
                    <p>Canvas tag not supported by your browser</p>
                </canvas>
            </div>

            <div id="righColumn">
                <div id="userlist">
                </div>
                <div id="drawCommands">
                    <div id="shapes">
                        <span id="line"> <img src="https://icons.iconarchive.com/icons/icons8/ios7/256/Editing-Line-icon.png"> </span>
                        <span id="pencil"> <img src="https://icons.iconarchive.com/icons/custom-icon-design/pretty-office-10/128/Pencil-icon.png"> </span>
                        <span id="rectangle"><img src="https://icons.iconarchive.com/icons/icons8/windows-8/128/Editing-Rectangle-Stroked-icon.png"></span>
                        <span id="circle"><img src="https://icons.iconarchive.com/icons/iconsmind/outline/128/Arrow-Circle-icon.png"></span>
                        <span id="webcam"><img src="https://icons.iconarchive.com/icons/iconshock/super-vista-general/128/webcam-icon.png"></span>
                    </div>
                    <div id="colors">
                        <ul>
                            <li>
                                Remplir  <input id="fillShapes" type="checkbox" checked/>
                            </li>
                            <li>
                                Remplissage:
                                <input id="fillColor" class="color" value="FFFFFF"/>
                            </li>
                            <li>
                                Bordure:
                                <input id="strokeColor" class="color" value="000000"/>
                            </li>
                            <li>
                                <!-- works only in Chrome and Opera, will display a standard input text in Firefox -->
                                Taille du crayon: <input id="strokeSize" type="range" min="0" max="20" value="1" step="0.5"
                                                    style="position:relative;top:6px;"/>
                            </li>
                        </ul>
                        
                    </div>
                </div>

                <div id="webcamDiv">
                    <h4>Simple web camera display</h4>
                    <video id="output" width="195" height="195" autoplay="true" autoplay>Put your fallback message here.</video>
                    <canvas id="preview" style="display: none" ></canvas>
                    <div id="log">    
                </div>
            </div>
            
        </div>
        </div>
<!--         <div id="chat">
            <div id="chatMessages"></div>
            <input type="text" id="chatTextInput">
            <button class="menuButton" type="button" id="chatSendButton">Send</button>
        </div>
 -->    </div>


     <script src="/socket.io/socket.io.js"></script>
     <script>   
        console.log('okokok')
        let url = JSON.parse(JSON.stringify(window.location)).href
        let params = new URLSearchParams(url)
        name = params.get("name")
        console.log("ZOMAOAMOA", url, params)
        name = name ? name : prompt('votre nom')
        
        const lastname = name, firstname = name 

         var socket = io();

    </script>
     <script src="js/jquery-1.7.2.min.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/paint.js"></script>
    <script src="js/drawingtools.js"></script>
    <!-- add this if you are not running in Opera and want a color chooser -->
    <script src="js/jscolor/jscolor.js"></script>
    <!-- NowJS is a High level lib built on top of socket.io. Uses WebSockets if available. The page needs to
be served by the NodeJS server -->
    <script src="js/chat.js"></script>
    <script src="js/webcam.js"></script> 
    <script type="text/javascript">
        socket.emit('infouser', {lastname,firstname})
        // Create the pseudo object which will handle the main canvas
      // Run when the DOM is ready
      $(document).ready(function () {
        console.log("1")
        var icam = false ;
        paint = new PaintObject("canvasMain");
        // Bind events to the canvas
        paint.bindMultiplexEvents();
          // prompts a dialog and asks for a nickname
        //   socket.name = prompt("What's your name?", "");
          //Create the pseudo object which will handle the chat
          chat = new ChatObject(socket,lastname,firstname);

        socket.on('paint',(paintCommand)=> {
            paint.processPaintCommand(paintCommand);
        })

        console.log("COOL")
        initCam() ;
        console.log("SUPER")
        $("#constantWebcam").click(()=>{
            icam = true ;
            console.log("Visio conf")
        })

        socket.on('stream',function(image){
            if(! icam) {
                $('#play').attr('src',image);                
            }
            // $('#log').text(image);

            // console.log('recpetion video conference')
        });


      });
 </script>
  </body>
</html>
